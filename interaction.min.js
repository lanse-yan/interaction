/*
  PType subType:生成分类的数据。其中pType是一级数据，subType是二级数据
    当pType为空时，会没有任何分类可展示;当PType或subType中只有一条分类，则选
    择这条数据且不可滚动。
  itemHeight：行高，这里设置成40px.如果有变动，请修改这个变量。
  currentArr：当前选择的分类的index([parIndex, subIndex])，指的是画面上的序数而非id
  selectArr: 当前选择的分类的Id([parId, subId])，指的是数据中的id
  _dis: 当前选择分类的分别移动的距离
  _maxPar, _minPar, _minSub, _maxSub分别指分类的可以移动的最大值和最小值
*/
!function(a){a.fn.scrollerD=function(b){if(this.length){b=a.extend({},a.scrollerD.defaults,b);var e,f,g,k,l,m,n,c=this,d=a(b.selector),h=[1,1],i=[],j=[0,0],o={};o.init=function(){e=b.data[0],f=b.data[1],g=b.itemHeigth,l=m=g,o.createUI(e,c,!0),o.createUI(f[i[0]],d),c.add(d).on("touchmove",function(a){a.preventDefault()}),c.swipeUp(o.swipeUp),c.swipeDown(o.swipeDown),d.swipeUp(o.swipeSubUp),d.swipeDown(o.swipeSubDown),a(b.confirm).on("click",o.confirmHanlder)},o.animateTransform=function(a,b){var c={transform:"translate3d(0, "+b+"px, 0)","-webkit-transform":"translate3d(0, "+b+"px, 0)"};a.css(c)},o.createUI=function(b,e,f){var h,g=e.find(".scroller");g.empty(),b&&(h=a("<ul>"),a.each(b,function(a,b){h.append("<li data-id="+a+">"+b+"</li>")}),g.append(h),f?o.getPboundary(c.find("li").length):o.getSboundary(d.find("li").length))},o.swipeUp=function(){var c;j[0]!==k&&(j[0]=j[0]-g,j[0]<k&&(j[0]=k),o.animateTransform(a(this).find(".scroller"),j[0]),h[0]=h[0]+1,c=a(this).find("li").removeClass("active").eq(h[0]).addClass("active").attr("data-id"),o.updateSubEle(c))},o.swipeDown=function(){if(j[0]!==l){j[0]=j[0]+g,j[0]>l&&(j[0]=l),o.animateTransform(a(this).find(".scroller"),j[0]),h[0]=h[0]-1;var c=a(this).find("li").removeClass("active").eq(h[0]).addClass("active").attr("data-id");o.updateSubEle(c)}},o.swipeSubUp=function(){if(j[1]!==n){j[1]=j[1]-g,j[1]<n&&(j[1]=n),o.animateTransform(a(this).find(".scroller"),j[1]),h[1]=h[1]+1;var c=a(this).find("li").removeClass("active").eq(h[1]).addClass("active").attr("data-id");i[1]=c}},o.swipeSubDown=function(){if(j[1]!==l){j[1]=j[1]+g,j[1]>m&&(j[1]=m),o.animateTransform(a(this).find(".scroller"),j[1]),h[1]=h[1]-1;var c=a(this).find("li").removeClass("active").eq(h[1]).addClass("active").attr("data-id");i[1]=c}},o.updateSubEle=function(a){o.createUI(f[a],d),i[0]=a},o.confirmHanlder=function(){var b="";b=i[0]?i[1]?e[i[0]]+" "+f[i[0]][i[1]]:e[i[0]]+"":"",a("#typeD").html(b),a("body").removeClass("stshow")},o.getPboundary=function(d){switch(d){case 0:k=l=m=n=0,i=[],h=[];break;case 1:k=g,i[0]=a("#wraPar").find("li").eq(0).attr("data-id"),o.animateTransform(c.find(".scroller"),g),c.find("li").addClass("active"),j[0]=g,h[0]=0;break;default:k=-1*g*(c.find("li").length-2);var e=1,f="";b.initData&&b.initData[0]?(e=c.find('li[data-id="'+b.initData[0]+'"]').addClass("active").index(),f=b.initData[0]):f=c.find("li").eq(1).addClass("active").attr("data-id"),i[0]=f,h[0]=e,j[0]=-1*(e-1)*g,o.animateTransform(c.find(".scroller"),j[0]),b.initData[0]=null}},o.getSboundary=function(a){switch(a){case 0:m=n=0,i[1]=void 0,h[1]=void 0;break;case 1:n=g,i[1]=d.find(".scroller").eq(0).attr("data-id"),o.animateTransform(d.find(".scroller"),g),d.find("li").addClass("active"),j[1]=g,h[1]=0;break;default:n=-1*g*(d.find("li").length-2);var c=1,e="";b.initData&&b.initData[1]?(c=d.find('li[data-id="'+b.initData[1]+'"]').addClass("active").index(),e=b.initData[1]):e=d.find("li").eq(1).addClass("active").attr("data-id"),i[1]=e,h[1]=c,j[1]=-1*(c-1)*g,o.animateTransform(d.find(".scroller"),j[1]),b.initData=null}},o.init()}},a.scrollerD={defaults:{selector:"#wraSub",itemHeigth:40,data:{},subData:{},confirm:"#confirm"}}}(Zepto);