/**
  * 支持至少2级联动。
*/
(function(a){a.fn.scrollerD=function(b){if(!this.length){return}b=a.extend({},a.scrollerD.defaults,b);var n=this,g,d,k,i,e=[1,1],l=[],f=[],m=[],h=[],j={},c=1;j.init=function(){i=b.itemHeigth;c=b.data.length;j.reset(h,c,i);j.createWrap();g=n.find(".wrapper");g.width(100/c+"%");j.createUI(b.data[0],g.eq(0),0);for(var o=1;o<c;o++){j.createUI(b.data[o][l[o-1]],g.eq(o),o)}n.on("touchmove",function(p){p.preventDefault()});g.swipeUp(j.swipeUp);g.swipeDown(j.swipeDown);n.find(".confirm").on("click",j.confirmHanlder)};j.animateTransform=function(q,o){var p={transform:"translate3d(0, "+o+"px, 0)","-webkit-transform":"translate3d(0, "+o+"px, 0)"};q.css(p)};j.createWrap=function(){var o=['<div class="selected bboth">'];o.push(b.selectHtml,'</div><div class="header"><span class="confirm">确定</span></div>');for(var p=0;p<c;p++){o.push('<div class="wrapper"><div class="scroller"></div></div>')}n.append(o.join(""))};j.createUI=function(s,r,p){var q=r.find(".scroller");q.empty();if(!s){return}var o=a("<ul>");a.each(s,function(t,u){o.append("<li data-id="+t+">"+u+"</li>")});q.append(o);j.getBoundary(q.find("li").length,p)};j.swipeUp=function(q){var p=g.index(this),o;if(f[p]===m[p]){return}f[p]=f[p]-i;if(f[p]<m[p]){f[p]=m[p]}j.animateTransform(a(this).find(".scroller"),f[p]);e[p]=e[p]+1;o=a(this).find("li").removeClass("active").eq(e[p]).addClass("active").attr("data-id");if((p+1)!==c){j.updateSubEle(o,p)}l[p]=o};j.swipeDown=function(q){var p=g.index(this),o;if(f[p]===h[p]){return}f[p]=f[p]+i;if(f[p]>h[p]){f[p]=h[p]}j.animateTransform(a(this).find(".scroller"),f[p]);e[p]=e[p]-1;o=a(this).find("li").removeClass("active").eq(e[p]).addClass("active").attr("data-id");if((p+1)!==c){j.updateSubEle(o,p)}l[p]=o};j.updateSubEle=function(p,o){j.createUI(b.data[o+1][p],g.eq(o+1),o+1)};j.confirmHanlder=function(){var o="";for(var p=0;p<c;p++){if(!l[p]){return o}if(p===0){o+=b.data[p][l[0]]}else{o+=" "+b.data[p][l[p-1]][l[p]]}}j.selectVal=o;b.confirmHandler(o);n.add(b.mask).hide();a(" body").removeClass("stshow")};j.getBoundary=function(r,p){switch(r){case 0:j.reset(h,c,0,p);j.reset(m,c,0,p);j.reset(f,c,0,p);j.reset(l,c,undefined,p);j.reset(e,c,undefined,p);break;case 1:var o=g.eq(p);m[p]=i;l[p]=o.find(".scroller").eq(0).attr("data-id");j.animateTransform(o.find(".scroller"),i);o.find("li").addClass("active");f[p]=i;e[p]=0;break;default:var s=1,q="",o=g.eq(p);m[p]=(-1)*i*(o.find("li").length-2);if(b.initData&&b.initData[p]){if(a.isArray(b.data[p])){b.initData[p]=b.data[p].indexOf(b.initData[p])}s=o.find('li[data-id="'+b.initData[p]+'"]').addClass("active").index();q=b.initData[p]}else{q=o.find("li").eq(1).addClass("active").attr("data-id")}l[p]=q;e[p]=s;f[p]=(-1)*(s-1)*i;j.animateTransform(o.find(".scroller"),f[p]);b.initData[p]=undefined}};j.reset=function(p,o,r,s){s=s||0;for(var q=s;q<o;q++){p[q]=r}};j.init();if(b.isShow){n.add(b.mask).show()}a(b.trigger).on("click",function(){n.add(b.mask).show();return false});a(b.mask).on("click",function(){n.add(b.mask).hide()});return{selectArr:l,selectVal:j.selectVal}};a.scrollerD={defaults:{selector:["#wraSub"],itemHeigth:40,data:{},subData:{},isShow:true,trigger:"#inter",mask:".mask",selectHtml:"",confirmHandler:function(){}}}})(Zepto);
